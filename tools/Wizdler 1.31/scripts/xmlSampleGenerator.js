var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define(["require","exports","xml","wsdl"],function(e,t,n,r){var i=function(){function e(){}return e.fromElement=function(e,t){var r=e.ownerDocument.createNSResolver(e),i=t.split(":");if(2!=i.length)throw new Error("Invalid qualified name: "+t);var a=r.lookupNamespaceURI(i[0]),o=i[1];return new n.QName(o,a)},e}();t.XmlQualifiedName=i;var a=function(){function e(){}return e.createGenerator=function(e,t,n){return{generateValue:function(t){return"["+e+(0===n?"?":"")+"]"}}},e.anyGenerator={generateValue:function(e){return"[anyType]"}},e.anySimpleTypeGenerator={generateValue:function(e){return"[anySimpleType]"}},e}();t.XmlValueGenerator=a;var o=function(){function e(e,t,n){this.root=null,this.elementTypesProcessed=null,this.instanceElementsProcessed=null,this.listLength=3,this.schemas=t.map(function(e){return e.el}),this.imports=n,this.listLength=3,this.targetNamespace=e,this.globalElements=this.getGlobalElements(),this.globalTypes=this.getGlobalTypes()}return e.prototype.writeXml=function(e){this.elementTypesProcessed=new Array;var t=this.findRootSchemaElement(e),n=this.generateElement(t);if(!n)throw new Error("Schema did not lead to generation of a valid XML document.");this.instanceElementsProcessed={},this.instanceElementsProcessed[n]=n;var r=document.implementation.createDocument(n.qname.namespace,n.qname.localName,null);if(n.documentation&&r.insertBefore(r.createComment(n.documentation),r.documentElement),null!=n.valueGenerator){var i;i=n.isFixed?n.fixedValue:n.hasDefault?n.defaultValue:n.valueGenerator.generateValue(),r.documentElement.appendChild(r.createTextNode(i))}else for(var a=n.child;a;a=a.sibling)this.processGroup(r.documentElement,a);return r},e.prototype.processGroup=function(e,t){if(t.isGroup){if(!t.isChoice)for(var n=0,r=t.occurs;r>n;++n)for(var i=t.child;i;)this.processGroup(e,i),i=i.sibling}else this.processElement(e,t)},e.prototype.processElement=function(e,t){if(!this.instanceElementsProcessed[t]){this.instanceElementsProcessed[t]=t;for(var n=e.ownerDocument,r=0,i=t.occurs;i>r;++r)if(t.documentation&&e.appendChild(n.createComment(t.documentation)),t.qname){t.valueGenerator||1==t.minOccurs&&1==t.maxOccurs||(0===t.minOccurs&&0===t.maxOccurs?e.appendChild(n.createComment(" Optional ")):e.appendChild(n.createComment(" Occurs: "+t.minOccurs+" - "+t.maxOccurs+" ")));var a=n.createElementNS(null===t.qname.namespace?"\x00":t.qname.namespace,t.qname.localName);if(t.isNillable){if(t.genNil){a.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","nil","true"),t.genNil=!1;continue}t.genNil=!0}if(null!=t.valueGenerator)t.isFixed?a.appendChild(n.createTextNode(t.fixedValue)):t.hasDefault?a.appendChild(n.createTextNode(t.defaultValue)):a.appendChild(n.createTextNode(t.valueGenerator.generateValue()));else for(var o=t.child;o;o=o.sibling)this.processGroup(a,o);e.appendChild(a)}delete this.instanceElementsProcessed[t]}},e.prototype.findSchemaDocEl=function(e){for(var t="http://www.w3.org/2001/XMLSchema",n=e;n;n=n.parentNode)if("schema"==n.localName&&n.namespaceURI==t)return n;return null},e.prototype.generateElement=function(e,t,r){var o=e,l=e.getAttributeNS(null,"ref");if(l){var u=i.fromElement(e,l),o=this.globalElements[String(u)];if(!o)return t&&t.addChild(new c("Invalid type reference: "+u)),null}if(this.isAbstract(o))return null;var h=this.elementTypesProcessed[o.dataIndex];if(null!=h){var p=this.getMinOccurs(e),m=this.getMaxOccurs(e);return!r&&p>0&&t.addChild(h.clone(this.getOccurs(p,m))),null}var f=this.findSchemaDocEl(e),g=f.getAttributeNS(null,"targetNamespace")||this.targetNamespace,d="qualified"==f.getAttributeNS(null,"elementFormDefault");t&&!d&&(g=null),h=new s(new n.QName(o.getAttributeNS(null,"name"),g)),t&&t.addChild(h);var p=this.getMinOccurs(r||e),m=this.getMinOccurs(r||e);h.minOccurs=p,h.maxOccurs=m;var y=(this.getOccurs(p,m),o.getAttributeNS(null,"default"),o.getAttributeNS(null,"fixed"),o.getAttributeNS(null,"nillable"),this.getSchemaType(o,"type"));if(y&&"http://www.w3.org/2001/XMLSchema"==y.namespace&&"any"==y.localName)h.valueGenerator=a.anyGenerator;else if(this.isComplexType(y)){o.dataIndex=this.elementTypesProcessed.length,this.elementTypesProcessed[o.dataIndex]=h;var v=y.getAttributeNS(null,"abstract");"1"!=v&&"true"!=v&&this.processComplexType(y,h)}else{var N=this.getSimpleDataType(y);h.valueGenerator=a.createGenerator(N,this.listLength,p)}return h.documentation=this.getDocumentation(e,o,this.isComplexType(y)?y:null),h},e.prototype.processComplexType=function(e,t){if(this.isSimpleContent(e)){var n=this.getSimpleDataType(e);t.valueGenerator=a.createGenerator(n,this.listLength)}else this.generateParticle(this.getContentTypeParticle(e),t)},e.prototype.isSimpleContent=function(e){return"string"==typeof e},e.prototype.generateParticle=function(e,t){if(e){var n=this.getMaxOccurs(e),r=this.getMinOccurs(e),i=this.getOccurs(r,n);if("sequence"==e.localName){var a=new l;a.occurs=i,a.minOccurs=r,a.maxOccurs=n,t.addChild(a),this.generateGroupBase(e,a)}else if("choice"==e.localName)if(1==n){var o=this.getContentTypeParticle(e);this.generateParticle(o,t)}else{var a=new l;a.occurs=i,a.minOccurs=r,a.maxOccurs=n,a.isChoice=!0,t.addChild(a),this.generateGroupBase(e,a)}else if("all"==e.localName)this.generateAll(e,t);else if("element"==e.localName){var s,c=e.getAttributeNS(null,"ref");c&&(s=this.getSubstitutionChoice(e)),s?this.generateParticle(s,t):this.generateElement(e,t)}else if("complexContent"==e.localName){var o=this.getChildren(e,"extension","restriction")[0];if(o){var u=this.getSchemaType(o,"base");u&&this.processComplexType(u,t),this.processComplexType(o,t)}}else"any"==e.localName&&this.generateAny(e,t)}},e.prototype.generateGroupBase=function(e,t){var n=this;this.getParticles(e).forEach(function(e){return n.generateParticle(e,t)})},e.prototype.generateAll=function(e,t){var n=this;this.getParticles(e).forEach(function(e){return n.generateParticle(e,t)})},e.prototype.generateAny=function(e,t){t.addChild(new c("Any elements"))},e.prototype.getParticles=function(e){return this.getChildren(e,"choice","sequence","all","element","any","complexContent")},e.prototype.getContentTypeParticle=function(e){return this.getParticles(e)[0]},e.prototype.getSimpleDataType=function(e){var t=this;if("string"==typeof e)return e;var n=this.getChildren(e,"restriction","list","union"),r="unknown";return n.forEach(function(e){switch(e.localName){case"restriction":return r=t.getSchemaType(e,"base"),!1;case"list":return r=t.getSchemaType(e,"itemType"),!1;case"union":return r=t.getSchemaType(e,"memberTypes"),!1}}),r},e.prototype.isComplexType=function(e){return null!=e&&"complexType"==e.localName},e.prototype.getSchemaType=function(e,t){var i=e.getAttributeNS(null,t);if(i){var a=new n.Xml(e).resolveNS(i,e.namespaceURI);if(a.namespace==r.NS.schema)return a.localName;var o=this.findGlobalType(a);return o}var l=this.getChildren(e,"complexType","simpleType");return l[0]||"any"},e.prototype.getDocumentation=function(e,t,n){for(var r=this,i=[],a=0,o=arguments.length;o>a;++a)arguments[a]&&arguments[a]!=arguments[a-1]&&this.getChildren(arguments[a],"annotation").forEach(function(e){r.getChildren(e,"documentation").forEach(function(e){i.push(e.textContent.trim())})});return i.length?i.join("\n"):void 0},e.prototype.getOccurs=function(e,t){return e},e.prototype.getMinOccurs=function(e){var t=e.getAttributeNS(null,"minOccurs");return t?(t=+t,isNaN(t)?1:t):1},e.prototype.getMaxOccurs=function(e){var t=e.getAttributeNS(null,"maxOccurs");return t?"unbounded"==t?1/0:(t=+t,isNaN(t)?1:t):1},e.prototype.getGlobalElements=function(){var e=this,t={};return this.schemas.forEach(function(r){var i=r.getAttributeNS(null,"targetNamespace");e.getChildren(r,"element").forEach(function(e){var r=e.getAttributeNS(null,"name"),a=new n.QName(r,i);t[String(a)]=e})}),this.imports.forEach(function(r){var i=r.XML.el,a=r.namespace||i.getAttributeNS(null,"targetNamespace");e.getChildren(i,"element").forEach(function(e){var r=e.getAttributeNS(null,"name"),i=new n.QName(r,a);t[String(i)]=e})}),t},e.prototype.getGlobalTypes=function(){var e=this,t={};return this.schemas.forEach(function(r){var i=r.getAttributeNS(null,"targetNamespace");e.getChildren(r,"complexType","simpleType").forEach(function(e){var r=e.getAttributeNS(null,"name"),a=new n.QName(r,i);t[String(a)]=e})}),this.imports.forEach(function(r){var i=r.XML.el,a=r.namespace||i.getAttributeNS(null,"targetNamespace");e.getChildren(i,"complexType","simpleType").forEach(function(e){var r=e.getAttributeNS(null,"name"),i=new n.QName(r,a);t[String(i)]=e})}),t},e.prototype.getSubstitutionChoice=function(e){return null},e.prototype.findGlobalType=function(e){var t=this.globalTypes[String(e)];if(!t)throw new Error("No global type was found: "+e);return t},e.prototype.findRootSchemaElement=function(e){if(e){var t=this.globalElements[String(e)];if(!t)throw new Error("No global element for root was found: "+e)}else for(var n in this.globalElements)if(this.globalElements.hasOwnProperty(n)&&!this.isAbstract(this.globalElements[n])){t=this.globalElements[n];break}if(!t)throw new Error("No root element was found.");if(this.isAbstract(t))throw new Error("Root element type is abstract.");return t},e.prototype.isAbstract=function(e){var t=e.getAttributeNS(null,"abstract");return"true"==t||"1"==t},e.prototype.getChildren=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r="http://www.w3.org/2001/XMLSchema",i=e.childNodes,a=new Array,o=0,l=i.length;l>o;++o){var s=i[o];if(1==s.nodeType&&s.namespaceURI==r)for(var c=1,u=arguments.length;u>c;++c)s.localName==arguments[c]&&a.push(s)}return a},e}();t.XmlSampleGenerator=o;var l=(function(){function e(){}return e}(),function(){function e(){this.occurs=1,this.isGroup=!0,this.isChoice=!1,this.parent=null,this.sibling=null,this.child=null}return e.prototype.addChild=function(e){if(e.parent=this,this.child){for(var t=null,n=this.child;n;)t=n,n=n.sibling;t.sibling=e}else this.child=e},e}()),s=function(e){function t(n){e.call(this),this.id=0,this.isGroup=!1,this.isMixed=!1,this.isNillable=!1,this.genNil=!0,this.xsiType=null,this.firstAttribute=null,this.id=++t.id,this.qname=n,this.minOccurs=1,this.maxOccurs=1}return __extends(t,e),t.prototype.clone=function(e){var n=new t;for(var r in this)this.hasOwnProperty(r)&&(n[r]=this[r]);return n.occurs=e,n.child=null,n.parent=null,n.sibling=null,n},t.prototype.toString=function(){return"InstanceElement"+this.id},t.id=0,t}(l),c=function(e){function t(n){e.call(this),this.occurs=1,this.id=++t.id,this.documentation=" "+n+" "}return __extends(t,e),t.prototype.toString=function(){return"CommentElement"+this.id},t.id=0,t}(s)});